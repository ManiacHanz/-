
### http1.1时如何复用tcp连接

头里有个`Connection`配置成`keep-alive`的选项，在一个`TCP`连接中可以进行多个`HTTP`请求，可以减少客户端和服务器连接时3次握手的消耗


### 简介service worker

[MDN](https://developer.mozilla.org/zh-CN/docs/Web/API/Service_Worker_API)
[腾讯AlloyTeam博文](http://www.alloyteam.com/2016/01/9274/)

> Service workers 本质上充当Web应用程序与浏览器之间的代理服务器，也可以在网络可用时作为浏览器和网络间的代理。它们旨在（除其他之外）使得能够创建有效的离线体验，拦截网络请求并基于网络是否可用以及更新的资源是否驻留在服务器上来采取适当的动作。他们还允许访问推送通知和后台同步API。

**只能基于HTTPS使用**

使用场景
* 后台消息传递
* 网络代理，转发请求，伪造响应
* 离线缓存
* 消息推送
* … …


### Http报文的请求会有几个部分

HTTP 报文是简单的格式化数据块。每条报文都包含一条请求或者响应。它们由三个部分组成：对报文进行描述的起始行（start line）、包含属性的头部（header）块，以及可选的，包含数据的主体（body）部分。

* 起始行：请求方法，请求URL，状态码等描述信息
* 头部： 请求头和响应头，对信息进行补充，比如`Content-type`,`Accept`等
* 主体： 传输的数据，文件等


### cookie放哪里，cookie能做的事情和存在的价值

cookie放在硬盘上，每次浏览器请求的时候会去硬盘上检查时候有相同域下的cookie，有就带上一起发给服务端

cookie可以当成一种标识，让服务端统计和区别新老访客；HTTPonly可以用来做登录id


### TCP

TCP(Transmission Control Protocol) 传输控制协议。位于第四层传输层。

TCP 五层 1 物理层 -> 2 数据链路层 -> 3 网络层(ip)-> 4 传输层(tcp) -> 5 应用层(http)

三次握手，四次握手 [更多知识](https://yuchengkai.cn/docs/zh/cs/#tcp)

客户端首先发送 syn包
服务端接受后确认， 返回syn/ack包 (acknowledgement)
客户端接收后确认，并发送ack包


### BASE64的优缺点

优点：
* 把图片变成了`base64`以后可以减少`network`里的请求次数，也减少并发请求量
* 没有缓存，所以不需要解决缓存问题

缺电：
* 没有缓存，使得在很多常驻的图片下不适用，也包括常驻的字体文件
* 如果背景图片过多的使用`base64`的图片，意味着`css`文件会很臃肿，而`css`的文件的加载时间是会阻滞页面的渲染，导致用户的白屏时间更长。同时对`Gzip`的支持也不是很好


### HTTP和HTTPS解析

来自[掘金](https://juejin.im/post/5c1913a46fb9a049db73119a)


### 说下浏览器缓存、DNS缓存、nginx缓存、服务端缓存的区别；强缓存和 协商缓存的应⽤
浏览器缓存分为强缓存和协商缓存，主要是由请求报文中的字段控制。缓存后的文件除了写入硬盘，一般浏览器执行后的js文件或者图片会被写入内存，比如说第一次打开某被缓存网页，其中所有文件都是`from disk cache`，然后此时刷新网页，js文件和图片文件会变成`from memory cache`，而css文件还是会从硬盘里读取

强缓存控制的字段主要是`expire`和`cache-control`。
* expire字段主要是在http1.0中使用，记录的是缓存过期的**绝对**时间。比对的时候是客户端和服务端的时间对比，所以不够准确
* cache-control 可用用于http1.1（现在浏览器默认支持）。其中的max-age同样可以记录过期的**相对**时间，优先级高于expire

协商缓存控制的字段主要是`etag/if-none-match`和`if-modified-since/last-modified`两组字段控制。逻辑大致相同，由客户端请求文件的时候在请求头里带上上次获取的缓存标识，服务端拿到这个标识和文件做对比，缓存生效则返回304让客户端从缓存中读取，如果不生效就返回新的文件和新的标识。`etag`优先级高于后者
* etag/if-none-match。是由服务端生成的标识。一致的时候标识无更新
* if-modified-since/last-modified。表示服务端的文件时间，服务端会受到if-modified-since的时间和文件变更时间做对比

DNS缓存
把访问过网站的url和对应的ip记录下来，下次就不需要去访问运营商服务器获取ip地址了


### http1.0 http1.1 http2.0

http1.0  特点：短连接。每次启动都必须启动一个TCP链接，链接无法复用。所以瓶颈就是TCP协议的三次握手消耗以及慢启动消耗

http1.1  特点：持久链接，可以复用一个TCP链接。复用方法，通过请求/响应头中的connection标记为keep-alive来控制。同时，比1.0更好的地方有，更好的缓存控制，cache-control替代expire；更好的带宽优化，一个请求未结束时，可以发送下一个请求；同时还增加了身份认证、状态管理等请求头

http2.0  特点：多路复用，服务端发推送，二进制分帧，首部压缩。多路复用指，2.0把协议通信的最小单位变为了帧，这些帧可以在一个连接上双向交换信息；服务端推送指，服务器可以对一个请求发送多次响应；二进制分帧指，2.0在应用层和传输层中间加入了一个二进制分帧层，头部信息放入HEADER frame，body放入BODY frame，并且用二进制取代了以前的文本；首部压缩是换了报文的压缩算法

2.0仍然是建立在TCP协议上，所以如果丢包，整个TCP都要开始等待重传，就会阻塞该TCP连接的其他请求

### 网络模型

七层：物数网传会表应(*p*lease *d*o *n*ot *t*ell *s*tupid *p*eople *a*nything)

物理层：
数据链路层：
网络层：IP
传输层：TCP、UDP协议 。 提供端对端接口
会话层：
表式层：
应用层：HTTP协议。向用户提供应用协议