

贴上掘金好文 - [GMTC 大前端时代前端监控的最佳实践](https://juejin.cn/post/6844903629573324807)


总结：
* 一般情况下的首屏渲染时长统计，可用Navigation API去统计，里面有丰富的各个时间段的时长统计

* SPA由于页面内容的特殊性，通过domContentLoaded去统计造成不准确，所以这里的方案是去根据dom结构生成一个有权重的dom树，通过mutationObserver Api去获取元素的改变，一般来说，层级越深的子元素权重会越高，因为他们代表的真正的内容。这里面要注意的问题主要是遍历树的结构以后造成的性能损失

* SPA特殊性还在于，在统计访问不同页面的pv时，需要通过拦截hash或者history state方法，做pv统计，而不是像传统的跳转型的页面在页面中统计

* 前端监控其实包含两个内容，监控和报警。告警的重点在于设定阈值，超过阈值后主动触发通知

* 监控的埋点上传，考虑性能需要考虑，可以考虑使用http2.0，主要对比1.1有以下几个优势：不占用http1.1的同域名的通信数量限制（即使散列域名也会造成多余的dns解析，握手等性能浪费）；压缩头部信息，减少传递数据大小；还可以考虑使用返回码204（不返回任何内容）等等

* 可以考虑重现操作步骤。从页面渲染开始作为第一帧，每次涉及到用户点击事件，或者是元素改变事件等等，通过js描述，然后保存在队列里。在报错以后上传到服务器，服务器通过固定规则解析，然后来重现报错的操作流程